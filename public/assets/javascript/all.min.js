angular.module("horribleFilm",["ngRoute","flash"]),angular.module("horribleFilm").config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"app/components/page/home.html"}).when("/register",{templateUrl:"app/components/page/register.html",controller:"SessionCtrl",controllerAs:"register"}).when("/login",{templateUrl:"app/components/page/login.html",controller:"SessionCtrl",controllerAs:"session"}).when("/users",{templateUrl:"app/components/user/index.html",controller:"UserCtrl",controllerAs:"user"}).when("/users/:user_name",{templateUrl:"app/components/user/show.html",controller:"UserShowCtrl",controllerAs:"userShow"}).when("/users/:user_name/edit",{templateUrl:"app/components/user/edit.html",controller:"UserEditCtrl",controllerAs:"userEdit"}),t.html5Mode(!0)}]),angular.module("horribleFilm").controller("MainCtrl",["Auth","$rootScope","$location",function(e,t,r){var o=this;o.loggedIn=e.isLoggedIn(),t.$on("$routeChangeStart",function(){o.loggedIn=e.isLoggedIn(),e.getUser().then(function(e){o.userName=e.data.userName},function(e){o.userName=void 0})}),o.logout=function(){e.logout(),r.path("/")}}]),angular.module("horribleFilm").factory("AuthToken",["$window",function(e){var t={};return t.getToken=function(){return e.localStorage.getItem("token")},t.setToken=function(t){t?e.localStorage.setItem("token",t):e.localStorage.removeItem("token")},t}]).factory("Auth",["$http","$q","AuthToken",function(e,t,r){var o={};return o.login=function(t,r){return e.post("/api/authenticate",{userName:t,password:r})},o.logout=function(){r.setToken()},o.isLoggedIn=function(){return r.getToken()?!0:!1},o.getUser=function(){return r.getToken()?e.get("/api/me"):t.reject({message:"Not logged in."})},o}]).factory("AuthInterceptor",["$q","$location","AuthToken",function(e,t,r){var o={};return o.request=function(e){var t=r.getToken();return t&&(e.headers["x-access-token"]=t),e},o.responseError=function(r){return 403==r.status&&t.path("/login"),e.reject(r)},o}]),angular.module("horribleFilm").factory("User",["$http",function(e){var t={};return t.all=function(){return e.get("/api/users/")},t.get=function(t){return e.get("/api/users/"+t)},t.create=function(t){return e.post("/api/users/",t)},t}]),angular.module("horribleFilm").controller("SessionCtrl",["User","Auth","$location","$http","AuthToken","Flash",function(e,t,r,o,n,s){var l=this;l.newUser={},l.submitRegistration=function(){e.create(l.newUser).then(function(e){e.data.success!==!1&&(s.create("success","User has been successfully created! Login and edit your profile now!!!","custom-class"),r.path("/users/"+l.newUser.userName+"/edit/"))})},l.login=function(){t.login(l.userName,l.password).then(function(e){1==e.data.success?(s.create("success","You have been successfully logged in!","custom-class"),n.setToken(e.data.token),r.path("/users")):s.create("danger","Wrong username/password combination.","custom-class")})}}]),angular.module("horribleFilm").controller("UserCtrl",["User",function(e){function t(){e.all().then(function(e){r.users=e.data})}var r=this;t()}]),angular.module("horribleFilm").controller("UserEditCtrl",["$routeParams","User",function(e,t){var r=this;t.get(e.user_name).then(function(e){r.profile=e.data.Profile})}]),angular.module("horribleFilm").controller("UserShowCtrl",["$routeParams","User",function(e,t){var r=this;t.get(e.user_name).then(function(e){r.user=e.data})}]),angular.module("horribleFilm").config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]);