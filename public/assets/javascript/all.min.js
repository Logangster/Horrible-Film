angular.module("horribleFilm",["ngRoute"]),angular.module("horribleFilm").config(["$routeProvider","$locationProvider",function(e,r){e.when("/",{templateUrl:"app/components/page/home.html"}).when("/register",{templateUrl:"app/components/page/register.html",controller:"RegistrationCtrl",controllerAs:"register"}).when("/users",{templateUrl:"app/components/user/index.html",controller:"UserCtrl",controllerAs:"user"}).when("/users/:user_name",{templateUrl:"app/components/user/show.html",controller:"UserShowCtrl",controllerAs:"userShow"}).when("/users/:user_name/edit",{templateUrl:"app/components/user/edit.html",controller:"UserEditCtrl",controllerAs:"userEdit"}),r.html5Mode(!0)}]),angular.module("horribleFilm").controller("MainCtrl",function(){var e=this;e.loggedIn=!1}),angular.module("horribleFilm").factory("AuthToken",["$window",function(e){var r={};return r.getToken=function(){return e.localStorage.getItem("token")},r.setToken=function(r){r?e.localStorage.setItem("token",r):e.localStorage.removeItem("token")},r}]).factory("Auth",["$http","$q","AuthToken",function(e,r,t){var n={};return n.login=function(r,n){return e.post("/api/authenticate",{userName:r,password:n}).then(function(e){return t.setToken(e.data.token),e.data})},n.logout=function(){t.setToken()},n.isLoggedIn=function(){return t.getToken()?!0:!1},n}]).factory("AuthInterceptor",["$q","$location","AuthToken",function(e,r,t){var n={};return n.request=function(e){var r=t.getToken();return r&&(e.headers["x-access-token"]=r),e},n.responseError=function(t){return console.log("Hey it worked"),403==t.status&&r.path("/login"),e.reject(t)},n}]),angular.module("horribleFilm").factory("User",["$http",function(e){var r={};return r.all=function(){return e.get("/api/users/")},r.get=function(r){return e.get("/api/users/"+r)},r.create=function(r){return e.post("/api/users/",r)},r}]),angular.module("horribleFilm").controller("RegistrationCtrl",["User","$location","$http",function(e,r,t){var n=this;n.newUser={},n.submitRegistration=function(){e.create(n.newUser).then(function(e){e.data.success!==!1&&r.path("/users/"+n.newUser.userName+"/edit/")})}}]),angular.module("horribleFilm").controller("UserCtrl",["User",function(e){function r(){e.all().then(function(e){t.users=e.data})}var t=this;r()}]),angular.module("horribleFilm").controller("UserEditCtrl",["$routeParams","User",function(e,r){var t=this;r.get(e.user_name).then(function(e){t.profile=e.data.Profile})}]),angular.module("horribleFilm").controller("UserShowCtrl",["$routeParams","User",function(e,r){var t=this;r.get(e.user_name).then(function(e){t.user=e.data})}]),angular.module("horribleFilm").config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor")}]);